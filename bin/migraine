#!/usr/bin/env php
<?php
if (file_exists(__DIR__ . '/../autoload.php')) {
    require_once __DIR__ . '/../autoload.php';
} elseif (file_exists(__DIR__ . '/../vendor/autoload.php')) {
    require_once __DIR__ . '/../vendor/autoload.php';
} elseif (file_exists(__DIR__ . '/../../../autoload.php')) {
    require_once __DIR__ . '/../../../autoload.php';
}

use CommandoX\Command;
use Migraine\Configuration\YamlParser;

$cmd = new Command();

$cmd->option()
    ->aka('task')
    ->default('default')
    ->describedAs('Task name');

$cmd->option('c')
    ->aka('config')
    ->default('migraine.yml')
    ->describedAs('Configuration filename');

try {
    $config = new YamlParser(file_get_contents($cmd['config']));
    $migraine = $config->parse()->getMigraine();
    $migraine->execute($cmd['task']);
} catch (\Exception $exception) {
    echo 'ERROR: ' . $exception->getMessage() . PHP_EOL;
}
